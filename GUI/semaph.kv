#:kivy 1.0.9
#:import FadeTransition kivy.uix.screenmanager.FadeTransition

MyScreenManager:
    transition: FadeTransition()
    Welcome:
    SecondScreen:
    Race:
    Impostazioni:
    WIP:

<Welcome>:
    name: 'Welcome'
    on_pre_enter: root.inFunz=0
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: './multimedia/sfondi/Welcome.jpg'
        Label:
            canvas:
                Color:
                    rgba: .1, .4, .2, .3
                Rectangle:
                    pos: (self.width/2 - 150 , self.height*3/4)
                    size : (300, self.font_size+10)

            text: 'Mini 4WD'
            color: 1, 0, 0, 1
            markup: True
            font_size: 70
            size_hint_y: None
            height: root.height*3/4
        BoxLayout:
            Button:
                background_color: .2, .7, .4, .7
                text: 'Gara!'
                font_size: 40
                on_release: root.PreRace()
                border: 25, 15, 0, 0
            Button:
                background_color: .2, .3, .4, .7
                text: 'Impostazioni'
                font_size: 40
                on_release: app.root.current = 'WIP'
                border: 25, 0, 0, 15

<Error>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: './multimedia/sfondi/Error.jpg'
        Label:
            id: title
            text: 'Errore'
            color: 1, 0, 0, 1
            markup: True
            font_size: 70
            size_hint_y: None
            height: root.height/4
        Label:
            canvas.before:
                Color:
                    rgba: .7, .2, .1, .8
                RoundedRectangle:
                    pos: (self.pos[0]+5, self.pos[1] + 5)
                    size: (self.size[0]-10, self.size[1] -10)
                    radius: [50, 50, 50, 50]
            text: root.ErrCode()
            color: .2, .7, .3, 1
            markup: True
            font_size: 30
            size_hint_y: None
            height: root.height/2
        BoxLayout:
            Button:
                border: 25, 15, 0, 0
                background_color: .2, .7, .4, .7
                text: 'Home'
                font_size: 40
                on_release: app.root.current = 'Welcome'
            Button:
                border: 25, 0, 0, 15
                background_color: .7, .2, .4, .7
                text: 'Esci'
                font_size: 40
                on_release: quit()
        BoxLayout:
            Button:
                border: 15, 0, 15, 0
                background_color: .2, .7, .1, .7
                text: 'Go To Race Anyway'
                font_size: 40
                on_release: app.root.current = 'Impostazioni'


<Race>:
    name: 'Race'
    fullscreen: True
    on_pre_enter: root.Aggiorna()
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: './multimedia/sfondi/Race.jpg'
        BoxLayout:
            size_hint_y: .27
            Label:
                id: TitoloCorsa
                size_hint_y: 1
                color: 1,0,0,1
                font_size: 100
                text: "Corsa"
            BoxLayout:
                id: upper_table
                orientation: 'vertical'
                size_hint_x: 1
                font_size: 35
                size_y: 300
                BoxLayout:
                    id: riga_1
                    size_hint_y: .3
                    Label:
                        canvas.before:
                            Color:
                                rgba: .4, .4, .2, .6
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [20, 0, 0, 0]
                        id: macchina_1
                        font_size: upper_table.font_size
                        color: .1, .2, .6, 1
                        text: root.F_Nome_1()
                    Button:
                        id: Ch_Bottone_Macchina_1
                        font_size: upper_table.font_size
                        text: "Rimuovi" if (root.CM1) else "Aggiungi"
                        disabled: root.ids.start_button.disabled
                        background_color: (.85, .2, .2, .8) if (root.CM1) else (.2,  .8, .2, .8)
                        color: .1, .1, .7, 1
                        on_release: root.CM1 = not root.CM1
                BoxLayout:
                    id: riga_2
                    size_hint_y: .3
                    Label:
                        canvas.before:
                            Color:
                                rgba: .4, .4, .2, .6
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [0, 0, 0, 0]
                        id: macchina_2
                        font_size: upper_table.font_size
                        color: .1, .2, .6, 1
                        text: root.F_Nome_2()
                    Button:
                        id: Ch_Bottone_Macchina_2
                        font_size: upper_table.font_size
                        text: "Rimuovi" if (root.CM2) else "Aggiungi"
                        disabled: root.ids.start_button.disabled
                        background_color: (.85, .2, .2, .8) if (root.CM2) else (.2,  .8, .2, .8)
                        color: .1, .1, .7, 1
                        on_release: root.CM2 = not root.CM2
                BoxLayout:
                    id: riga_3
                    size_hint_y: .3
                    Label:
                        canvas.before:
                            Color:
                                rgba: .4, .4, .2, .6
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [0, 0, 0, 20]
                        id: macchina_3
                        font_size: upper_table.font_size
                        color: .1, .2, .6, 1
                        text: root.F_Nome_3()
                    Button:
                        id: Ch_Bottone_Macchina_3
                        font_size: upper_table.font_size
                        text: "Rimuovi" if (root.CM3) else "Aggiungi"
                        disabled: root.ids.start_button.disabled
                        background_color: (.85, .2, .2, .8) if (root.CM3) else (.2,  .8, .2, .8)
                        color: .1, .1, .7, 1
                        on_release: root.CM3 = not root.CM3
        BoxLayout:
            size_hint_y: .05
            size_hint_x: 1
            #Spazio vuoto
        BoxLayout:
            BoxLayout:
                orientation: 'vertical'
                Label:
                    font_size: 75
                    id: timer
                    size_hint_y: .25
                    size_hint_x: 1
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        RoundedRectangle:
                            pos: (self.pos [0] + self.size[0]/10, self.pos[1])
                            size: (self.size[0]*4/5, self.size[1])
                            radius: [10, 10, 10, 10]

                    color: 0, 1, .25, 1
                    #font: 100
                    text: "000:00"
                BoxLayout:
                    id: time_table
                    orientation: 'vertical'
                    font_size: 35
                    BoxLayout:
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, .75
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius : 30, 30, 0, 0
                        Label:
                            id: Table_Macchina_1
                            size_hint_x: .33
                            size_hint_y:1
                            font_size: time_table.font_size
                            text: macchina_1.text if(root.CM1) else ""
                            color: (.1, .7, .2, 1) if (root.IP1) else (.7, .1, .2, 1)
                        Label:
                            id: Table_Macchina_2
                            size_hint_x: .33
                            size_hint_y:1
                            font_size: time_table.font_size
                            text: macchina_2.text if(root.CM2) else ""
                            color: (.1, .7, .2, 1) if (root.IP2) else (.7, .1, .2, 1)
                        Label:
                            id: Table_Macchina_3
                            size_hint_x: .33
                            size_hint_y:1
                            font_size: time_table.font_size
                            text: macchina_3.text if(root.CM3) else ""
                            color: (.1, .7, .2, 1) if (root.IP3) else (.7, .1, .2, 1)
                    BoxLayout:
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, .75
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        Label:
                            id: tempo11
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[0] if (root.CM1) else ""
                            color: Table_Macchina_1.color
                        Label:
                            id: tempo21
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[1] if (root.CM2) else ""
                            color: Table_Macchina_2.color
                        Label:
                            id: tempo31
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[2] if (root.CM3) else ""
                            color: Table_Macchina_3.color
                    BoxLayout:
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, .75
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        Label:
                            id: tempo12
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[3] if (root.CM1) else ""
                            color: Table_Macchina_1.color
                        Label:
                            id: tempo22
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[4] if (root.CM2) else ""
                            color: Table_Macchina_2.color
                        Label:
                            id: tempo32
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[5] if (root.CM3) else ""
                            color: Table_Macchina_3.color
                    BoxLayout:
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, .75
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius : 0, 0, 30, 30
                        Label:
                            id: tempo13
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[6] if (root.CM1) else ""
                            color: Table_Macchina_1.color
                        Label:
                            id: tempo23
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[7] if (root.CM2) else ""
                            color: Table_Macchina_2.color
                        Label:
                            id: tempo33
                            size_hint_x: .33
                            font_size: time_table.font_size
                            text: root.TempoPiste[8] if (root.CM3) else ""
                            color: Table_Macchina_3.color
                BoxLayout:
                    size_hint_y: .5
            BoxLayout:
                orientation: 'vertical'
                BoxLayout:
                    BoxLayout:
                        size_hint_y: 1
                        size_hint_x: 1
                        canvas:
                            Color:
                                rgba: 0, 0, 0, .9
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [30, 20, 20, 30]

                        BoxLayout:
                            #size_hint_y:1
                            id: Red_Light
                            bgcolor: 1, 0, 0, 1
                            canvas:
                                Color:
                                    rgba: self.bgcolor
                                Ellipse:
                                    pos: self.pos
                                    size: (self.size[0], self.size[0]) if (self.size[0] < self.size[1]) else (self.size[1], self.size[1])
                        BoxLayout:
                            id: Yellow_Light
                            bgcolor: .9, .4, .1, 1
                            canvas:
                                Color:
                                    rgba: self.bgcolor
                                Ellipse:
                                    pos: self.pos
                                    size: (self.size[0], self.size[0]) if (self.size[0] < self.size[1]) else (self.size[1], self.size[1])
                        BoxLayout:
                            id: Green_Light
                            bgcolor:  0, 1, 0, 1
                            canvas:
                                Color:
                                    rgba: self.bgcolor
                                Ellipse:
                                    pos: self.pos
                                    size: (self.size[0], self.size[0]) if (self.size[0] < self.size[1]) else (self.size[1], self.size[1])
                BoxLayout:
                    orientation: 'vertical'
                    BoxLayout:
                        id: Button_Box
                        font_size: 30
                        Button:
                            id: start_button
                            font_size: Button_Box.font_size
                            background_color: .3, .9, .2, .9
                            border: 15, 15,0, 0
                            color: 0, 1, 0, 1
                            disabled: True if ((start_button.color[0] == 1)or(start_button.color[2] == .1)) else False
                            on_release: root.Start()
                            text: "Start"
                        Button:
                            id: stop_button
                            font_size: Button_Box.font_size
                            background_color: 1, .1, .1 , .9
                            border: 15, 0, 0, 15
                            color: 1, 0, 0, 1
                            disabled: False if (stop_button.color[0] == 0) else True
                            on_release: root.Stop()
                            text: "Stop"
                    Button:
                        id: settings_button
                        font_size: Button_Box.font_size
                        border: 0, 15, 15, 0
                        color: 0, 1, 0, 1
                        disabled: True if (settings_button.color[0] == 1) else False
                        background_color: .3, .3, .9, 1
                        text: "impostazioni"
                        on_release: app.root.current = 'Impostazioni'
                Label:
                    #text: "test"

<Impostazioni>
    name: 'Impostazioni'
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: './multimedia/sfondi/Settings.jpg'
        Label:
            size_hint_y : .2
            font_size: 75
            color: 0, 0, 1, 1
            text: "Impostazioni"
        BoxLayout:
            BoxLayout:
                orientation:'vertical'
                BoxLayout:
                    size_y: 50
                    Label:
                        canvas.before:
                            Color:
                                rgba: .6, .6, .3, .75
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [50, 50, 50, 50]
                        size_hint_y: 1
                        font_size: 30
                        color: .5, 0, 1, 1
                        text:"Nome Corsa"
                BoxLayout:
                    size_y:100
                    TextInput:
                        id: Input_C
                        size_hint_y: 1
                        font_size: 30
                        text: root.F_Nome_C()
                        on_text: root.Check_Nome_C()
                    Button:
                        id: Button_Save_C
                        background_color: (0, 1, 0, .75)
                        border: 25, 10, 0, 0
                        size_hint_y: 1
                        size_hint_x: .6
                        font_size: 30
                        text: "Save"
                        on_release: root.Save_C()
                BoxLayout:
                    size_y: 50
                    Label:
                        canvas.before:
                            Color:
                                rgba: .6, .6, .3, .75
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [50, 50, 50, 50]

                        size_hint_y: 1
                        font_size: 30
                        color: .5, 0, 1, 1
                        text:"Nome Macchine"
                BoxLayout:
                    size_y:100
                    TextInput:
                        id: Input_N1
                        size_hint_y: 1
                        size_hint_x: .8
                        font_size: 30
                        text: root.F_Nome_1()
                        on_text: root.Check_Nome_1()
                    Button:
                        id: Button_Save_N1
                        background_color: (0, 1, 0, .75)
                        border: 25, 10, 0, 0
                        size_hint_y: 1
                        size_hint_x: .25
                        font_size: 30
                        text: "Save"
                        on_release: root.Save_N1()
                    Button:
                        background_color: (0, 0, 1, .75)
                        border: 25, 0, 0, 10
                        disabled: True if (Button_Save_N1.background_color[1] == 1) else False
                        size_hint_y: 1
                        font_size: 30
                        size_hint_x: .25
                        text: "Reset"
                        on_release: Input_N1.text = root.F_Nome_1()
                BoxLayout:
                    size_y:100
                    TextInput:
                        id: Input_N2
                        size_hint_y: 1
                        size_hint_x: .8
                        font_size: 30
                        text: root.F_Nome_2()
                        on_text: root.Check_Nome_2()
                    Button:
                        id: Button_Save_N2
                        background_color: (0, 1, 0, .75)
                        border: 0, 10, 0, 0
                        size_hint_y: 1
                        font_size: 30
                        size_hint_x: .25
                        text: "Save"
                        on_release: root.Save_N2()
                    Button:
                        background_color: (0, 0, 1, .75)
                        border: 0, 0, 0, 10
                        disabled: True if (Button_Save_N2.background_color[1] == 1) else False
                        size_hint_y: 1
                        font_size: 30
                        size_hint_x: .25
                        text: "Reset"
                        on_release: Input_N2.text = root.F_Nome_2()
                BoxLayout:
                    size_y: 100
                    TextInput:
                        id: Input_N3
                        size_hint_y: 1
                        size_hint_x: .8
                        font_size: 30
                        text: root.F_Nome_3()
                        on_text: root.Check_Nome_3()
                    Button:
                        id: Button_Save_N3
                        background_color: (0, 1, 0, .75)
                        border: 0, 10, 25, 0
                        size_hint_y: 1
                        font_size: 30
                        size_hint_x: .25
                        text: "Save"
                        on_release: root.Save_N3()
                    Button:
                        background_color: (0, 0, 1, .75)
                        border: 0, 0, 25, 10
                        disabled: True if (Button_Save_N3.background_color[1] == 1) else False
                        size_hint_y: 1
                        font_size: 30
                        size_hint_x: .25
                        text: "Reset"
                        on_release: Input_N3.text = root.F_Nome_3()
                Button:
                    background_color: (.25, .8, .2, .75)
                    border: 15, 10, 0, 0
                    size_hint_y: 1
                    font_size: 30
                    text: "Race"
                    on_release: app.root.current = 'Race'
            BoxLayout:
                orientation: 'vertical'
                Label:
                    text: "campo vuoto"
                Button:
                    background_color: (.8, .25, .2, .75)
                    border: 25, 0, 0, 10
                    size_hint_y: .18
                    yize_hint_x: .5
                    font_size: 30
                    text: "Home"
                    on_release: app.root.current = 'Welcome'

<WIP>
    name:'WIP'
    BoxLayout:
        orientation: 'vertical'
        canvas:
            Rectangle:
                pos: self.pos
                size: self.size
                source: './multimedia/sfondi/WIP.jpg'
        Label:
            text: "Work In Progress"
        Button:
            size_hint_y: .2
            text: 'Home'
            on_release: app.root.current = 'Welcome'


<SecondScreen>:
    name: 'second'
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'second screen!'
            font_size: 30
        BoxLayout:
            Button:
                text: 'goto first screen'
                font_size: 30
                on_release: app.root.current = 'Welcome'
            Button:
                text: 'get random colour screen'
                font_size: 30
                on_release: app.root.new_colour_screen()
<ColourScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'colour {:.2},{:.2},{:.2} screen'.format(*root.colour[:3])
            font_size: 30
        Widget:
            canvas:
                Color:
                    rgba: root.colour
                Ellipse:
                    pos: self.pos
                    size: self.size
        BoxLayout:
            Button:
                text: 'goto first screen'
                font_size: 30
                on_release: app.root.current = 'first'
            Button:
                text: 'get random colour screen'
                font_size: 30
                on_release: app.root.new_colour_screen()
